<% content_for :page_title, "View product - Market Surveillance & Product Safety" %>
<div class="show-product">

<div class="breadcrumbs">
    <ol role="breadcrumbs">
        <li>
            <a href="/">Home</a>
        </li>
        <li>
            <%= link_to 'Products', products_path %>
        </li>
        <li>
            <%= link_to 'View', @product %>
        </li>
    </ol>
</div>

<h1 class="heading-xlarge"><%= @product.name %></h1>

<div class="govuk-grid-row">
  <div class="govuk-grid-column-full company-details large-space-below">
    <table class="company-details-table">
      <thead>
      <tr>
        <th class="company-details-header">Product Details</th>
        <th></th>
      </tr>
      </thead>
      <tbody>
        <tr>
          <td>Product ID</td>
          <td><%= @product.id %></td>
        </tr>
        <tr>
          <td>GTIN (Global Trade Item Number/Barcode)</td>
          <td><%= @product.gtin %></td>
        </tr>
        <tr>
          <td>Brand</td>
          <td><%= @product.brand %></td>
        </tr>
        <tr>
          <td>Description</td>
          <td><%= @product.description %></td>
        </tr>
        <tr>
          <td>Model</td>
          <td><%= @product.model %></td>
        </tr>
        <tr>
          <td>Batch number</td>
          <td><%= @product.batch_number %></td>
        </tr>
        <tr>
          <td>Serial number</td>
          <td><%= @product.serial_number %></td>
        </tr>
        <tr>
          <td>URL reference</td>
          <td><%= link_to(@product.url_reference, @product.url_reference, target: "_blank") unless @product.url_reference.nil? %></td>
        </tr>
        <tr>
          <td>Manufacturer</td>
          <td><%= @product.manufacturer %></td>
        </tr>
        <tr>
          <td>Country of origin</td>
          <td><%= @product.country_of_origin_for_display %></td>
        </tr>
        <tr>
          <td>Date placed on the market</td>
          <td><%= @product.date_placed_on_market&.to_s :long_ordinal %></td>
        </tr>
        <tr>
          <td>Associated parts or components</td>
          <td><%= @product.associated_parts %></td>
        </tr>
        <tr>
          <td>Source</td>
          <td><%= @product.source.show %></td>
        </tr>
      </tbody>
    </table>
    <%= link_to "Add more details", edit_product_path(@product)%>
  </div>
</div>

<div class="slider-nav">
  <% @product.images.attachments.each do |image| %>
    <% render "images/image_tag", image: image, dimensions: "300x200" %>
  <% end %>
  <% @product.rapex_images.each do |image| %>
    <%= image_tag(image.url, alt: image.title) %>
  <% end %>
</div>

<div class="govuk-grid-row" id="images">
  <div class="govuk-grid-column-full">
    <% if @product.images.attached? %>
      <h2 class="govuk-heading-l govuk-!-margin-bottom-1"><%= "Images (#{@product.images.size})" %></h2>
      <% @product.images.attachments.limit(2).each do |image| %>
        <%= render "images/image", image: image, dimensions: "300x200" %>
      <% end %>
      <br/>
    <% else %>
      <h2 class="govuk-heading-l govuk-!-margin-bottom-1">Images</h2>
      <p>No images.</p>
    <% end %>
    <%= link_to "Manage images", associated_images_path(@product), class: "no-print" %>
  </div>
</div>

<div class="govuk-grid-row" id="documents">
  <div class="govuk-grid-column-full">
    <h2 class="govuk-heading-l govuk-!-margin-bottom-1">Documents</h2>
    <% if @product.documents.attached? %>
      <table class="govuk-table">
        <thead class="govuk-table__head">
        <tr class="govuk-table__row">
          <th class="govuk-table__header" scope="col">Title</th>
          <th class="govuk-table__header" scope="col">Upload date</th>
          <th class="govuk-table__header" scope="col"></th>
        </tr>
        </thead>
        <tbody class="govuk-table__body">
        <% @product.documents.attachments.each do |document|  %>
          <%= render "document_summary", document: document, parent: @product %>
        <% end %>
        </tbody>
      </table>
    <% else %>
      <p>No documents.</p>
    <% end %>
    <%= link_to "Manage documents", associated_documents_path(@product), class: "no-print" %>
  </div>
</div>

<% if @product.investigations.any? -%>
  <div class="govuk-grid-row" id="investigations">
    <div class="govuk-grid-column-full">
      <h2 class="govuk-heading-l govuk-!-margin-bottom-1">Cases</h2>
      <% @product.investigations.each do |investigation| %>
        <p><%= link_to investigation.id, investigation %></p>
      <% end %>
    </div>
  </div>
<% end -%>

<div class="form-group no-print">
  <%= link_to 'Create PDF document', product_path(@product, :format => :pdf) %>
</div>

<div class="form-group no-print">
  <%= link_to 'Back', products_path, :class => "link-back" %>
</div>

<%= render 'history', versions: @product.versions %>

</div>
