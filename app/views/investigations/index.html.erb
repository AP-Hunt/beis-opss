<% content_for :page_title, "Cases - Market Surveillance & Product Safety" %>

<% content_for :after_header do %>
  <%= render "layouts/navbar" %>
<% end %>

<% if @current_user %>
  <div class="govuk-grid-row govuk-!-padding-bottom-4">
    <div class="govuk-grid-column-one-third">
      <div class="govuk-grid-column-one-quarter assigned-number govuk-!-font-size-36 govuk-!-font-weight-bold">
        <%= @investigations.where(assignee: @current_user).count %>
      </div>
      <div class="govuk-grid-column-three-quarters govuk-!-font-size-19">
        <%= "Case".pluralize(@investigations.where(assignee: @current_user).count) %> assigned to you
      </div>
    </div>
  </div>
<% end %>

<%= form_with(model: @search, scope: "", url: investigations_path, method: :get, class: "search-background govuk-!-padding-3") do |form| %>
  <% if @search.sort.present? %>
    <%= form.hidden_field :sort %>
    <%= form.hidden_field :direction %>
  <% end %>
  <div class="govuk-grid-row">
    <div class="govuk-form-group govuk-grid-column-full">
      <%= form.label "Search for keywords", class: "govuk-label" %>
      <%= form.text_field :q, class: "govuk-input" %>
    </div>
  </div>
  <div class="govuk-grid-row">
    <div class="govuk-form-group govuk-grid-column-one-third govuk-!-margin-bottom-0">
      <%= form.label :status, class: "govuk-label" %>
      <%= form.select :status, { "Open": "open", "Closed": "closed" },
                      { include_blank: "Any" }, class: "govuk-select" %>
    </div>
    <div class="govuk-form-group govuk-grid-column-one-third govuk-!-margin-bottom-0 govuk-!-margin-top-6">
      <%= form.submit "Search", name: nil, class: "govuk-button govuk-!-margin-bottom-0" %>
    </div>
  </div>
<% end %>

<br/>

<p><%= link_to 'Create new case', new_investigation_path, class: "govuk-!-font-size-19  govuk-!-font-weight-bold" %></p>

<%= render 'table' %>
<%= will_paginate @investigations %>
<br/>
<%= link_to "Export as spreadsheet", investigations_path(format: :xlsx) %>

